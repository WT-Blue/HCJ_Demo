<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Asynchronous demo</title>
</head>
<body>
  <p>å›è°ƒå‡½æ•°ç­‰å¾…3ç§’åæ‰§è¡Œ</p>
  <p id="demo"></p>
  <p id="demo1"></p>
  <script>
      setTimeout(function (){
        document.getElementById('demo').innerHTML = "RUNOOB-1!";
      },3000);
      document.getElementById('demo1').innerHTML = "RUNOOB-2!";
      console.log("2");

      //promiseç±»ï¼Œå¯ä»¥æ›´åŠ ä¼˜é›…çš„ä¹¦å†™å¤æ‚çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå¦‚ä¸‹é¢çš„"è®¡æ—¶å™¨"
      new Promise(function (resolve,reject){
          setTimeout(function (){
              console.log("First");
              resolve();
          },1000);
      }).then(function (){
          return new Promise(function (resolve, reject){
              setTimeout(function (){
                  console.log("Second");
                  resolve();
              },4000);
          });
      }).then(function (){
          setTimeout(function (){
              console.log("THird");
          },3000);
      });

      //resolveå’Œrejectéƒ½æ˜¯å‡½æ•°ï¼Œå…¶ä¸­è°ƒç”¨resolveä»£è¡¨ä¸€åˆ‡æ­£å¸¸ï¼Œrejectæ˜¯å‡ºç°å¼‚å¸¸å¼æ‰€è°ƒç”¨çš„ï¼š
      new Promise(function (resolve, reject){
          var a = 0;
          var b = 0;
          if(b==0) reject("Dicide zero");
          else resolve(a / b);
      }).then(function (value){
          console.log("a / b = " + value);
      }).catch(function (err){
          console.log(err);
      }).finally(function (){
          console.log("End");
      });

      //resolve()ä¸­å¯ä»¥æ”¾ç½®ä¸€ä¸ªå‚æ•°ç”¨äºå‘ä¸€ä¸ªthenä¼ é€’ä¸€ä¸ªå€¼ï¼Œthenä¸­çš„å‡½æ•°ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå€¼ä¼ é€’ç»™then.
      //ä½†æ˜¯ï¼Œå¦‚æœthenä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªthenå°†ç›¸å½“äºå¯¹è¿™ä¸ªè¿”å›çš„Promiseè¿›è¡Œæ“ä½œ
      //reject()å‚æ•°ä¸­ä¸€èˆ¬ä¼šä¼ é€’ä¸€ä¸ªå¼‚å¸¸ç»™ä¹‹åçš„catchå‡½æ•°ç”¨äºå¤„ç†å¼‚å¸¸
      //ä¸¤ç‚¹æ³¨æ„ï¼š
      //resolveå’Œrejectçš„ä½œç”¨åŸŸåªæœ‰èµ·å§‹å‡½æ•°ï¼Œä¸åŒ…æ‹¬thenä»¥åŠå…¶ä»–åºåˆ—
      //resolveå’Œrejectå¹¶ä¸èƒ½å¤Ÿä½¿èµ·å§‹å‡½æ•°åœæ­¢è¿è¡Œï¼Œåˆ«å¿˜äº†return
      new Promise(function (resolve, reject){
          console.log(1111);
          resolve(2222);
      }).then(function (value){
          console.log(value);
          return 3333;
      }).then(function (value){
          console.log(value);
          throw "An error";
      }).catch(function (err){
          console.log(err);
      });

      //ä¸Šè¿°çš„"è®¡æ—¶å™¨"ç¨‹åºçœ‹ä¸Šå»å¾ˆé•¿ï¼Œå¯ä»¥å°†å®ƒçš„æ ¸å¿ƒéƒ¨åˆ†å†™æˆä¸€ä¸ªPromiseå‡½æ•°ï¼š
      function print(delay,message){
          return new Promise(function (resolve, reject){
              setTimeout(function (){
                  console.log(message);
                  resolve();
              },delay);
          });
      }
      //å®ç°è®¡æ—¶å™¨ç¨‹åºåŠŸèƒ½,è¿™ç§è¿”å›å€¼ä¸ºä¸€ä¸ªPromiseå¯¹è±¡çš„å‡½æ•°ç§°ä½œPromiseå‡½æ•°ï¼Œä»–å¸¸å¸¸ç”¨äºå¼€å‘åŸºäºå¼‚æ­¥æ“ä½œçš„åº“
      print(1000,"First").then(function (){
          return print(4000,"Second");   //thenå—é»˜è®¤ä¼šå‘ä¸‹ğŸ‘‡é¡ºåºæ‰§è¡Œï¼Œreturnä»£è¡¨ä¸èƒ½ä¸­æ–­çš„
          // è‹¥æƒ³è¦åœ¨thenå—ä¸­æ–­ï¼Œå¯ä»¥é€šè¿‡throwæ¥è·³è½¬è‡³catchå®ç°ä¸­æ–­
      }).then(function (){
          print(3000,"Third");
      });

      //å¼‚æ­¥å‡½æ•°async function,å°†ä¸Šé¢çš„ä»£ç å˜å¾—æ›´å¥½çœ‹
      async function asyncFunc(){
          await print(1000,"First");
          await print(4000,"Second");
          await print(3000,"Third");
      }
      asyncFunc();

      //å¼‚æ­¥å‡½æ•°async functionï¼Œå¤„ç†å¼‚å¸¸çš„æœºåˆ¶å°†ç”¨try-catchå—å®ç°
      async function asyncFunc1(){
          try{
              await new Promise(function (resolve, reject){
                  throw "Some error";   //æˆ–è€…rejectï¼ˆ"Some error")
              });
          }catch (err){
              console.log(err);
              //ä¼šè¾“å‡ºSome error
          }
      }
      asyncFunc1();

      //å¦‚æœPromiseæœ‰ä¸€ä¸ªæ­£å¸¸çš„è¿”å›å€¼ï¼Œawaitè¯­å¥ä¹Ÿä¼šè¿”å›å®ƒ
      async function asycnFunc2(){
          let value = await new Promise(
              function (resolve, reject){
                  resolve("Return value");
              });
          console.log(value);
      }
      asycnFunc2();
  </script>
</body>
</html>
